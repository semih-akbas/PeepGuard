<!DOCTYPE html>
<html>
    <head>
      <title>PeepGuard</title>
      <script src="socket.io/socket.io.js"></script>
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
      <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">
      <script src = "http://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>
      <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
      <script type="text/javascript">
        google.charts.load('current', {'packages':['corechart', 'gauge']});
        
        google.charts.setOnLoadCallback(drawChart);
        var cpuPercentage;
        var memoryPercentage;

        function drawChart() {
          drawTemperatureChart();
          drawGauges();
        }

        function drawTemperatureChart() {
          var data = google.visualization.arrayToDataTable([
            ['Time', 'Temperature(°C)'],
            {{{temperature_data}}}
          ]);
  
          var options = {
            title: 'CPU Temperature Trend',
            curveType: 'function',
            legend: { position: 'bottom' }
          };
  
          var chart = new google.visualization.AreaChart(document.getElementById('curve_chart'));
  
          chart.draw(data, options);
        }

        function drawGauges(memory, cpu) {
          cpuPercentage = cpu;
          memoryPercentage = memory;
          console.log("CPU:" + cpu);
          console.log("MEMORY:" + memory);
          var data = google.visualization.arrayToDataTable([
          ['Label', 'Value'],
          ['Memory', memory],
          ['CPU', cpu]
        ]);

        var options = {
          width: 400, height: 120,
          redFrom: 90, redTo: 100,
          yellowFrom:75, yellowTo: 90,
          minorTicks: 5
        };
  
          var chart = new google.visualization.Gauge(document.getElementById('cpu_chart'));
        
          chart.draw(data, options);
        }
        
      </script>
      <script>
      $(document).ready(function(){
            var socket = io();
            $("#update_temperature").click(function(){
              //socket.emit('refresh-temperature');
            });
            socket.on('refresh-data',function(temperature, cpu){
              $("#current_temperature").text(temperature + ' °C');
            });
            socket.on('refresh-cpu',function(cpu){
              console.log("refresh-cpu");
              drawGauges(memoryPercentage, cpu);
            });
            socket.on('refresh-memory',function(memory){
              console.log("refresh-memory");
              drawGauges(memory, cpuPercentage);
            });
      });
      </script>
    </head>
    <body>
      <div style = "padding:20px;">
        <h2>PeepGuard: Diagnostics</h2>
      </div>
      <table>
          <tr>
            <td>
                <div style="margin:15px">
                    <div style="float: left;padding: 10px;"><h4>Current Temperature: </h4></div>
                    <h3><div id="current_temperature" style = "float: left;padding: 10px;margin-top:5px;color:blue;"></div></h3>
                </div>
            </td>
            <td>
                <div id = "cpu_chart"
                style = "width: 200px;
                         height: 200px;
                         padding: 5px;"
                </div>
            </td>
          </tr>
          <tr>
            <td>
                <div>{{deneme}}</div>
                <td>
                    <div id = "memory_chart"
                    style = "width: 200px;
                             height: 200px;
                             padding: 5px;"
                    </div>
                </td>
            </td>
          </tr>
          <tr>
            <td>
                <div id = "curve_chart"
                class = "jumbotron"
                style = "width: 600px;
                         height: 200px;
                         padding: 0px;
                         margin-left:-10px;
                         margin-top:40px;">
                </div>
            </td>
            <td>
                <div id = "disk_chart"
                style = "width: 200px;
                         height: 200px;
                         padding: 5px;"
                </div>
            </td>
          </tr>
     </table>    
      
      
      
    </body>
  </html>