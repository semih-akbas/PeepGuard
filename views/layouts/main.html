<!DOCTYPE html>
<html>
    <head>
      <title>PeepGuard</title>
      <script src="socket.io/socket.io.js"></script>
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
      <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">
      <script src = "http://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>
      <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
      <script type="text/javascript">
        google.charts.load('current', {'packages':['corechart', 'gauge']});
        google.charts.setOnLoadCallback(drawCharts);

        var cpuTemperature = 0;
        var cpuPercentage = 0;
        var memoryPercentage = 0;
        var diskPercentage = 0;
        var arrCpuTempChart = [
                                ['Time', 'Temperature(°C)'],
                                {{{temperature_data}}}
                               ];
        var dataCpuTempChart;                     
        var dataGauge;
        var chartOptions = {
            title: 'CPU Temperature Trend',
            curveType: 'function',
            legend: { position: 'bottom' }
          };
        var drawGauges;

        function drawCharts() {
          dataCpuTempChart = google.visualization.arrayToDataTable(arrCpuTempChart);
          dataGauge = google.visualization.arrayToDataTable([
              ['Label', 'Value'],
              ['CPU Temp (°C)',cpuTemperature],
              ['Memory %',memoryPercentage],
              ['CPU %',cpuPercentage], 
              ['Disk %',diskPercentage]
              ]);
          drawTemperatureChart(dataCpuTempChart);
          drawGauges(0,0);
        }

        function drawTemperatureChart(data) {
          dataCpuTempChart = data;
          var chart = new google.visualization.AreaChart(document.getElementById('cputemp_chart'));  
          chart.draw(data, chartOptions);
        }

        drawGauges = function (temperature, memory, cpu, disk) {
          cpuPercentage = cpu;
          memoryPercentage = memory;
          diskPercentage = disk;
          
          dataGauge.setValue(0, 1, temperature);
          dataGauge.setValue(1, 1, memory);
          dataGauge.setValue(2, 1, cpu);
          dataGauge.setValue(3, 1, disk);
          
          var options = {
            width: 500, height: 250,
            redFrom: 90, redTo: 100,
            yellowFrom:75, yellowTo: 90,
            minorTicks: 5
          };

          google.charts.load('current', {'packages':['gauge']});
          var gauge_chart = new google.visualization.Gauge(document.getElementById('gauge_chart'));
          gauge_chart.draw(dataGauge, options);
        }
        
      </script>
      <script>
      $(document).ready(function(){
            var socket = io();
            $("#update_temperature").click(function(){
              //socket.emit('refresh-temperature');
            });
            socket.on('refresh-temperature',function(temperature, data){
              cpuTemperature = temperature;
              arrCpuTempChart.push(data);
              dataCpuTempChart = google.visualization.arrayToDataTable(arrCpuTempChart);
              drawTemperatureChart(dataCpuTempChart);
              drawGauges(temperature, memoryPercentage, cpuPercentage, diskPercentage);
            });
            socket.on('refresh-cpu',function(cpu){
              drawGauges(cpuTemperature, memoryPercentage, cpu, diskPercentage);
            });
            socket.on('refresh-memory',function(memory){
              drawGauges(cpuTemperature, memory, cpuPercentage, diskPercentage);
            });
            socket.on('refresh-diskinfo',function(diskpercentage, diskavailable, diskused, disktotal){
              drawGauges(cpuTemperature, memoryPercentage, cpuPercentage, diskpercentage);
            });
      });
      </script>
    </head>
    <body>
      <div style = "padding:20px;">
        <h2>PeepGuard: Diagnostics</h2>
      </div>
      <table>
          <tr>
            <td colspan="2">
              <div id = "gauge_chart"
              style = "width: 300px;
                       height: 150px;
                       padding: 20px;
                       margin-left:10px;"
              </div>
            </td>
          </tr>
          <tr>
            <td>
                <div id = "cputemp_chart"
                class = "jumbotron"
                style = "width: 600px;
                         height: 200px;
                         padding: 0px;
                         margin-left:-25px;
                         margin-top:30px;">
                </div>
            </td>
            <td>
                <div id = "disk_chart"
                style = "width: 200px;
                         height: 200px;
                         padding: 5px;"
                </div>
            </td>
          </tr>
     </table>    
      
      
      
    </body>
  </html>